version: "3"
services: 
    # api-server:
    #     image: sample-app
    #     ports: 
    #         - "3000:3000"
    #     depends_on: 
    #         - redis
    #         - mongo
    redis:
        image: redis
        ports: 
            - "6379:6379"
        volumes: 
            - redis-data:/data/db
    mongo:
        image: mongo
        ports:
            - "27017:27017"
        volumes: 
            - mongo-data:/data/db
    elasticsearch:
        image: docker.elastic.co/elasticsearch/elasticsearch:7.13.0
        container_name: elasticsearch
        environment:
            - xpack.security.enabled=false
            - discovery.type=single-node
        ulimits:
            memlock:
                soft: -1
                hard: -1
            nofile:
                soft: 65536
                hard: 65536
        volumes:
            - esdata01:/usr/share/elasticsearch/data
        ports:
            - "9200:9200"
            - "9300:9300"
        networks:
            - elastic

    # es02:
    #     image: docker.elastic.co/elasticsearch/elasticsearch:7.13.0
    #     container_name: es02
    #     environment:
    #         - node.name=es02
    #         - cluster.name=es-docker-cluster
    #         - discovery.seed_hosts=es01,es03
    #         - cluster.initial_master_nodes=es01,es02,es03
    #         - bootstrap.memory_lock=true
    #         - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    #     ulimits:
    #         memlock:
    #             soft: -1
    #             hard: -1
    #     volumes:
    #         - data02:/usr/share/elasticsearch/data
    #     networks:
    #         - elastic
    # es03:
    #     image: docker.elastic.co/elasticsearch/elasticsearch:7.13.0
    #     container_name: es03
    #     environment:
    #         - node.name=es03
    #         - cluster.name=es-docker-cluster
    #         - discovery.seed_hosts=es01,es02
    #         - cluster.initial_master_nodes=es01,es02,es03
    #         - bootstrap.memory_lock=true
    #         - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    #     ulimits:
    #         memlock:
    #             soft: -1
    #             hard: -1
    #     volumes:
    #         - data03:/usr/share/elasticsearch/data
    #     networks:
    #         - elastic

    kib01:
        image: docker.elastic.co/kibana/kibana:7.13.0
        container_name: kib01
        ports:
            - 5601:5601
        environment:
            ELASTICSEARCH_URL: http://elasticsearch:9200
            ELASTICSEARCH_HOSTS: "http://elasticsearch:9200"
        networks:
            - elastic
volumes: 
    mongo-data:
        driver: local
    redis-data:
        driver: local
    esdata01:
        driver: local

networks:
    elastic:
        driver: bridge
    
